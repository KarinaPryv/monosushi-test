{"ast":null,"code":"import _asyncToGenerator from \"/Users/karyna/Desktop/monosushi/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { deleteObject, getDownloadURL, percentage, ref, uploadBytesResumable } from '@angular/fire/storage';\nlet AdminArticlesComponent = class AdminArticlesComponent {\n  constructor(fb, productsService, categoriesService, storage) {\n    this.fb = fb;\n    this.productsService = productsService;\n    this.categoriesService = categoriesService;\n    this.storage = storage;\n    this.adminProducts = new Array();\n    this.isFormHidden = true;\n    this.editStatus = false;\n    this.isUploaded = false;\n    this.adminCategories = new Array();\n  }\n\n  ngOnInit() {\n    this.getCategories();\n    this.getProducts();\n    this.initProductsForm();\n  }\n\n  initProductsForm() {\n    this.productsForm = this.fb.group({\n      category: [null, Validators.required],\n      name: [null, Validators.required],\n      path: [null, Validators.required],\n      ingridients: [null, Validators.required],\n      weight: [null, Validators.required],\n      price: [null, Validators.required],\n      imagePath: [null, Validators.required],\n      count: [1]\n    });\n  }\n\n  getCategories() {\n    this.categoriesService.getAll().subscribe(categories => {\n      this.adminCategories = categories;\n      this.productsForm.patchValue({\n        category: this.adminCategories[0].name\n      });\n    });\n  }\n\n  getProducts() {\n    this.productsService.getAll().subscribe(products => {\n      this.adminProducts = products;\n    });\n  }\n\n  addProduct() {\n    this.isFormHidden = false;\n  }\n\n  saveProduct() {\n    if (this.editStatus) {\n      this.productsService.update(this.productsForm.value, this.currentProductId).subscribe(() => {\n        this.getProducts();\n      });\n    } else {\n      this.productsService.create(this.productsForm.value).subscribe(() => {\n        this.getProducts();\n      });\n    }\n\n    this.editStatus = false;\n    this.productsForm.reset();\n    this.isUploaded = false;\n    this.uploadPercent = 0;\n    this.isFormHidden = true;\n  }\n\n  deleteProduct(discountId) {\n    this.productsService.delete(discountId).subscribe(() => {\n      this.getProducts();\n    });\n  }\n\n  editProduct(editedCategory) {\n    this.productsForm.patchValue({\n      category: editedCategory.category,\n      name: editedCategory.name,\n      path: editedCategory.path,\n      ingridients: editedCategory.ingridients,\n      weight: editedCategory.weight,\n      price: editedCategory.price,\n      imagePath: editedCategory.imagePath\n    });\n    this.editStatus = true;\n    this.currentProductId = editedCategory.id;\n    this.isUploaded = true;\n    this.isFormHidden = false;\n  }\n\n  upload(event) {\n    const file = event.target.files[0];\n    this.uploadFile('images', file.name, file).then(data => {\n      this.productsForm.patchValue({\n        imagePath: data\n      });\n      this.isUploaded = true;\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  uploadFile(folder, name, file) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const path = `${folder}/${name}`;\n      let url = '';\n\n      if (file) {\n        try {\n          const storageRef = ref(_this.storage, path);\n          const task = uploadBytesResumable(storageRef, file);\n          percentage(task).subscribe(data => {\n            _this.uploadPercent = data.progress;\n          });\n          yield task;\n          url = yield getDownloadURL(storageRef);\n        } catch (e) {\n          console.error(e);\n        }\n      } else {\n        console.log('wrong format');\n      }\n\n      return Promise.resolve(url);\n    })();\n  }\n\n  valueByControl(control) {\n    var _a;\n\n    return (_a = this.productsForm.get(control)) === null || _a === void 0 ? void 0 : _a.value;\n  }\n\n  deleteImage() {\n    const task = ref(this.storage, this.valueByControl('imagePath'));\n    deleteObject(task).then(() => {\n      this.isUploaded = false;\n      this.uploadPercent = 0;\n      this.productsForm.patchValue({\n        imagePath: null\n      });\n    });\n  }\n\n};\nAdminArticlesComponent = __decorate([Component({\n  selector: 'app-admin-articles',\n  templateUrl: './admin-articles.component.html',\n  styleUrls: ['./admin-articles.component.scss']\n})], AdminArticlesComponent);\nexport { AdminArticlesComponent };","map":{"version":3,"sources":["/Users/karyna/Desktop/monosushi/src/app/admin/admin-articles/admin-articles.component.ts"],"names":["__decorate","Component","Validators","deleteObject","getDownloadURL","percentage","ref","uploadBytesResumable","AdminArticlesComponent","constructor","fb","productsService","categoriesService","storage","adminProducts","Array","isFormHidden","editStatus","isUploaded","adminCategories","ngOnInit","getCategories","getProducts","initProductsForm","productsForm","group","category","required","name","path","ingridients","weight","price","imagePath","count","getAll","subscribe","categories","patchValue","products","addProduct","saveProduct","update","value","currentProductId","create","reset","uploadPercent","deleteProduct","discountId","delete","editProduct","editedCategory","id","upload","event","file","target","files","uploadFile","then","data","catch","err","console","log","folder","url","storageRef","task","progress","e","error","Promise","resolve","valueByControl","control","_a","get","deleteImage","selector","templateUrl","styleUrls"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { deleteObject, getDownloadURL, percentage, ref, uploadBytesResumable } from '@angular/fire/storage';\nlet AdminArticlesComponent = class AdminArticlesComponent {\n    constructor(fb, productsService, categoriesService, storage) {\n        this.fb = fb;\n        this.productsService = productsService;\n        this.categoriesService = categoriesService;\n        this.storage = storage;\n        this.adminProducts = new Array();\n        this.isFormHidden = true;\n        this.editStatus = false;\n        this.isUploaded = false;\n        this.adminCategories = new Array();\n    }\n    ngOnInit() {\n        this.getCategories();\n        this.getProducts();\n        this.initProductsForm();\n    }\n    initProductsForm() {\n        this.productsForm = this.fb.group({\n            category: [null, Validators.required],\n            name: [null, Validators.required],\n            path: [null, Validators.required],\n            ingridients: [null, Validators.required],\n            weight: [null, Validators.required],\n            price: [null, Validators.required],\n            imagePath: [null, Validators.required],\n            count: [1]\n        });\n    }\n    getCategories() {\n        this.categoriesService.getAll().subscribe(categories => {\n            this.adminCategories = categories;\n            this.productsForm.patchValue({\n                category: this.adminCategories[0].name\n            });\n        });\n    }\n    getProducts() {\n        this.productsService.getAll().subscribe(products => {\n            this.adminProducts = products;\n        });\n    }\n    addProduct() {\n        this.isFormHidden = false;\n    }\n    saveProduct() {\n        if (this.editStatus) {\n            this.productsService.update(this.productsForm.value, this.currentProductId).subscribe(() => {\n                this.getProducts();\n            });\n        }\n        else {\n            this.productsService.create(this.productsForm.value).subscribe(() => {\n                this.getProducts();\n            });\n        }\n        this.editStatus = false;\n        this.productsForm.reset();\n        this.isUploaded = false;\n        this.uploadPercent = 0;\n        this.isFormHidden = true;\n    }\n    deleteProduct(discountId) {\n        this.productsService.delete(discountId).subscribe(() => {\n            this.getProducts();\n        });\n    }\n    editProduct(editedCategory) {\n        this.productsForm.patchValue({\n            category: editedCategory.category,\n            name: editedCategory.name,\n            path: editedCategory.path,\n            ingridients: editedCategory.ingridients,\n            weight: editedCategory.weight,\n            price: editedCategory.price,\n            imagePath: editedCategory.imagePath,\n        });\n        this.editStatus = true;\n        this.currentProductId = editedCategory.id;\n        this.isUploaded = true;\n        this.isFormHidden = false;\n    }\n    upload(event) {\n        const file = event.target.files[0];\n        this.uploadFile('images', file.name, file)\n            .then(data => {\n            this.productsForm.patchValue({\n                imagePath: data\n            });\n            this.isUploaded = true;\n        })\n            .catch(err => {\n            console.log(err);\n        });\n    }\n    async uploadFile(folder, name, file) {\n        const path = `${folder}/${name}`;\n        let url = '';\n        if (file) {\n            try {\n                const storageRef = ref(this.storage, path);\n                const task = uploadBytesResumable(storageRef, file);\n                percentage(task).subscribe(data => {\n                    this.uploadPercent = data.progress;\n                });\n                await task;\n                url = await getDownloadURL(storageRef);\n            }\n            catch (e) {\n                console.error(e);\n            }\n        }\n        else {\n            console.log('wrong format');\n        }\n        return Promise.resolve(url);\n    }\n    valueByControl(control) {\n        var _a;\n        return (_a = this.productsForm.get(control)) === null || _a === void 0 ? void 0 : _a.value;\n    }\n    deleteImage() {\n        const task = ref(this.storage, this.valueByControl('imagePath'));\n        deleteObject(task).then(() => {\n            this.isUploaded = false;\n            this.uploadPercent = 0;\n            this.productsForm.patchValue({\n                imagePath: null\n            });\n        });\n    }\n};\nAdminArticlesComponent = __decorate([\n    Component({\n        selector: 'app-admin-articles',\n        templateUrl: './admin-articles.component.html',\n        styleUrls: ['./admin-articles.component.scss']\n    })\n], AdminArticlesComponent);\nexport { AdminArticlesComponent };\n"]},"metadata":{},"sourceType":"module"}