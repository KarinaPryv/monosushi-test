{"ast":null,"code":"import _asyncToGenerator from \"/Users/karyna/Desktop/monosushi/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { deleteObject, getDownloadURL, percentage, ref, uploadBytesResumable } from '@angular/fire/storage';\nlet AdminArticlesComponent = class AdminArticlesComponent {\n  constructor(fb, productsService, categoriesService, storage) {\n    this.fb = fb;\n    this.productsService = productsService;\n    this.categoriesService = categoriesService;\n    this.storage = storage;\n    this.adminProducts = new Array();\n    this.isFormHidden = true;\n    this.editStatus = false;\n    this.isUploaded = false;\n    this.adminCategories = new Array();\n  }\n\n  ngOnInit() {\n    this.getCategories();\n    this.getProducts();\n    this.initProductsForm();\n  }\n\n  getCategories() {\n    this.categoriesService.getAll().subscribe(categories => {\n      this.adminCategories = categories;\n      this.productsForm.patchValue({\n        category: this.adminCategories[0].id\n      });\n    });\n  }\n\n  getProducts() {\n    this.productsService.getAll().subscribe(products => {\n      this.adminProducts = products;\n    });\n  }\n\n  initProductsForm() {\n    this.productsForm = this.fb.group({\n      name: [null, Validators.required],\n      title: [null, Validators.required],\n      description: [null, Validators.required],\n      imagePath: ['https://monosushi.com.ua/wp-content/uploads/2020/12/rol-tyzhnya-2-1-697x379.png', Validators.required]\n    });\n  }\n\n  addProduct() {\n    this.isFormHidden = false;\n  }\n\n  saveProduct() {\n    if (this.editStatus) {\n      this.productsService.update(this.productsForm.value, this.currentProductId).subscribe(() => {\n        this.getProducts();\n      });\n    } else {\n      this.productsService.create(this.productsForm.value).subscribe(() => {\n        this.getProducts();\n      });\n    }\n\n    this.editStatus = false;\n    this.productsForm.reset();\n    this.isUploaded = false;\n    this.uploadPercent = 0;\n    this.isFormHidden = true;\n  }\n\n  deleteProduct(discountId) {\n    this.productsService.delete(discountId).subscribe(() => {\n      this.getProducts();\n    });\n  }\n\n  editProduct(editedDiscount) {\n    this.productsForm.patchValue({// name: editedDiscount.name,\n      // title: editedDiscount.title,\n      // description: editedDiscount.description,\n      // imagePath: editedDiscount.imagePath,\n    });\n    this.editStatus = true;\n    this.currentProductId = editedDiscount.id;\n    this.isUploaded = true;\n    this.isFormHidden = false;\n  }\n\n  upload(event) {\n    const file = event.target.files[0];\n    this.uploadFile('images', file.name, file).then(data => {\n      this.productsForm.patchValue({\n        imagePath: data\n      });\n      this.isUploaded = true;\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  uploadFile(folder, name, file) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const path = `${folder}/${name}`;\n      let url = '';\n\n      if (file) {\n        try {\n          const storageRef = ref(_this.storage, path);\n          const task = uploadBytesResumable(storageRef, file);\n          percentage(task).subscribe(data => {\n            _this.uploadPercent = data.progress;\n          });\n          yield task;\n          url = yield getDownloadURL(storageRef);\n        } catch (e) {\n          console.error(e);\n        }\n      } else {\n        console.log('wrong format');\n      }\n\n      return Promise.resolve(url);\n    })();\n  }\n\n  valueByControl(control) {\n    var _a;\n\n    return (_a = this.productsForm.get(control)) === null || _a === void 0 ? void 0 : _a.value;\n  }\n\n  deleteImage() {\n    const task = ref(this.storage, this.valueByControl('imagePath'));\n    deleteObject(task).then(() => {\n      this.isUploaded = false;\n      this.uploadPercent = 0;\n      this.productsForm.patchValue({\n        imagePath: null\n      });\n    });\n  }\n\n};\nAdminArticlesComponent = __decorate([Component({\n  selector: 'app-admin-articles',\n  templateUrl: './admin-articles.component.html',\n  styleUrls: ['./admin-articles.component.scss']\n})], AdminArticlesComponent);\nexport { AdminArticlesComponent };","map":{"version":3,"sources":["/Users/karyna/Desktop/monosushi/src/app/admin/admin-articles/admin-articles.component.ts"],"names":["__decorate","Component","Validators","deleteObject","getDownloadURL","percentage","ref","uploadBytesResumable","AdminArticlesComponent","constructor","fb","productsService","categoriesService","storage","adminProducts","Array","isFormHidden","editStatus","isUploaded","adminCategories","ngOnInit","getCategories","getProducts","initProductsForm","getAll","subscribe","categories","productsForm","patchValue","category","id","products","group","name","required","title","description","imagePath","addProduct","saveProduct","update","value","currentProductId","create","reset","uploadPercent","deleteProduct","discountId","delete","editProduct","editedDiscount","upload","event","file","target","files","uploadFile","then","data","catch","err","console","log","folder","path","url","storageRef","task","progress","e","error","Promise","resolve","valueByControl","control","_a","get","deleteImage","selector","templateUrl","styleUrls"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { deleteObject, getDownloadURL, percentage, ref, uploadBytesResumable } from '@angular/fire/storage';\nlet AdminArticlesComponent = class AdminArticlesComponent {\n    constructor(fb, productsService, categoriesService, storage) {\n        this.fb = fb;\n        this.productsService = productsService;\n        this.categoriesService = categoriesService;\n        this.storage = storage;\n        this.adminProducts = new Array();\n        this.isFormHidden = true;\n        this.editStatus = false;\n        this.isUploaded = false;\n        this.adminCategories = new Array();\n    }\n    ngOnInit() {\n        this.getCategories();\n        this.getProducts();\n        this.initProductsForm();\n    }\n    getCategories() {\n        this.categoriesService.getAll().subscribe(categories => {\n            this.adminCategories = categories;\n            this.productsForm.patchValue({\n                category: this.adminCategories[0].id\n            });\n        });\n    }\n    getProducts() {\n        this.productsService.getAll().subscribe(products => {\n            this.adminProducts = products;\n        });\n    }\n    initProductsForm() {\n        this.productsForm = this.fb.group({\n            name: [null, Validators.required],\n            title: [null, Validators.required],\n            description: [null, Validators.required],\n            imagePath: ['https://monosushi.com.ua/wp-content/uploads/2020/12/rol-tyzhnya-2-1-697x379.png', Validators.required]\n        });\n    }\n    addProduct() {\n        this.isFormHidden = false;\n    }\n    saveProduct() {\n        if (this.editStatus) {\n            this.productsService.update(this.productsForm.value, this.currentProductId).subscribe(() => {\n                this.getProducts();\n            });\n        }\n        else {\n            this.productsService.create(this.productsForm.value).subscribe(() => {\n                this.getProducts();\n            });\n        }\n        this.editStatus = false;\n        this.productsForm.reset();\n        this.isUploaded = false;\n        this.uploadPercent = 0;\n        this.isFormHidden = true;\n    }\n    deleteProduct(discountId) {\n        this.productsService.delete(discountId).subscribe(() => {\n            this.getProducts();\n        });\n    }\n    editProduct(editedDiscount) {\n        this.productsForm.patchValue({\n        // name: editedDiscount.name,\n        // title: editedDiscount.title,\n        // description: editedDiscount.description,\n        // imagePath: editedDiscount.imagePath,\n        });\n        this.editStatus = true;\n        this.currentProductId = editedDiscount.id;\n        this.isUploaded = true;\n        this.isFormHidden = false;\n    }\n    upload(event) {\n        const file = event.target.files[0];\n        this.uploadFile('images', file.name, file)\n            .then(data => {\n            this.productsForm.patchValue({\n                imagePath: data\n            });\n            this.isUploaded = true;\n        })\n            .catch(err => {\n            console.log(err);\n        });\n    }\n    async uploadFile(folder, name, file) {\n        const path = `${folder}/${name}`;\n        let url = '';\n        if (file) {\n            try {\n                const storageRef = ref(this.storage, path);\n                const task = uploadBytesResumable(storageRef, file);\n                percentage(task).subscribe(data => {\n                    this.uploadPercent = data.progress;\n                });\n                await task;\n                url = await getDownloadURL(storageRef);\n            }\n            catch (e) {\n                console.error(e);\n            }\n        }\n        else {\n            console.log('wrong format');\n        }\n        return Promise.resolve(url);\n    }\n    valueByControl(control) {\n        var _a;\n        return (_a = this.productsForm.get(control)) === null || _a === void 0 ? void 0 : _a.value;\n    }\n    deleteImage() {\n        const task = ref(this.storage, this.valueByControl('imagePath'));\n        deleteObject(task).then(() => {\n            this.isUploaded = false;\n            this.uploadPercent = 0;\n            this.productsForm.patchValue({\n                imagePath: null\n            });\n        });\n    }\n};\nAdminArticlesComponent = __decorate([\n    Component({\n        selector: 'app-admin-articles',\n        templateUrl: './admin-articles.component.html',\n        styleUrls: ['./admin-articles.component.scss']\n    })\n], AdminArticlesComponent);\nexport { AdminArticlesComponent };\n"]},"metadata":{},"sourceType":"module"}